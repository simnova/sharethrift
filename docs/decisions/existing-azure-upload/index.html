<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-decisions/existing-azure-upload" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Existing Azure Upload Implementation | Sharethrift Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://developers.sharethrift.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://developers.sharethrift.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://developers.sharethrift.com/docs/decisions/existing-azure-upload"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Existing Azure Upload Implementation | Sharethrift Docs"><meta data-rh="true" name="description" content="Existing Azure Upload with Direct client uploads using Azure Blob SAS tokens."><meta data-rh="true" property="og:description" content="Existing Azure Upload with Direct client uploads using Azure Blob SAS tokens."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://developers.sharethrift.com/docs/decisions/existing-azure-upload"><link data-rh="true" rel="alternate" href="https://developers.sharethrift.com/docs/decisions/existing-azure-upload" hreflang="en"><link data-rh="true" rel="alternate" href="https://developers.sharethrift.com/docs/decisions/existing-azure-upload" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Decisions","item":"https://developers.sharethrift.com/docs/category/decisions"},{"@type":"ListItem","position":2,"name":"0022 Existing Azure Upload","item":"https://developers.sharethrift.com/docs/decisions/existing-azure-upload"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Sharethrift Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Sharethrift Docs Atom Feed"><link rel="stylesheet" href="/assets/css/styles.081213ac.css">
<script src="/assets/js/runtime~main.eaba0abf.js" defer="defer"></script>
<script src="/assets/js/main.cdbf1bd1.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_YnJl" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Sharethrift Logo" class="themedComponent_jyE1 themedComponent--light_OUff"><img src="/img/logo.svg" alt="Sharethrift Logo" class="themedComponent_jyE1 themedComponent--dark_aDxZ"></div><b class="navbar__title text--truncate">Home</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Doc</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/simnova/sharethrift" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_z7OM"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_YFSN colorModeToggle__ti1"><button class="clean-btn toggleButton_R2F7 toggleButtonDisabled_Mxo2" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_MtKO lightToggleIcon_r026"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_MtKO darkToggleIcon_ikf3"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_MtKO systemToggleIcon_N3nO"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_vbMF"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_UNGN"><div class="docsWrapper_m18Q"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_pFY2" type="button"></button><div class="docRoot_oo5D"><aside class="theme-doc-sidebar-container docSidebarContainer_leLC"><div class="sidebarViewport_MSxz"><div class="sidebar_NAmV"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_Dek_"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro"><span title="Introduction ðŸ‘‹" class="linkLabel_P7mk">Introduction ðŸ‘‹</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_PIrx menu__link menu__link--sublist" href="/docs/category/technical-overview"><span title="Technical Overview" class="categoryLinkLabel_xVlR">Technical Overview</span></a><button aria-label="Expand sidebar category &#x27;Technical Overview&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_PIrx menu__link menu__link--sublist menu__link--active" href="/docs/category/decisions"><span title="Decisions" class="categoryLinkLabel_xVlR">Decisions</span></a><button aria-label="Collapse sidebar category &#x27;Decisions&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/madr-architecture-decisions"><span title="0001 MADR Architecture Decisions" class="linkLabel_P7mk">0001 MADR Architecture Decisions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/open-telemetry"><span title="0002 Open Telemetry" class="linkLabel_P7mk">0002 Open Telemetry</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/domain-driven-design"><span title="0003 Domain Driven Design" class="linkLabel_P7mk">0003 Domain Driven Design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/identity-access"><span title="0004 Identity and Access Control" class="linkLabel_P7mk">0004 Identity and Access Control</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/authorization"><span title="0005 Authorization and Access Pattern" class="linkLabel_P7mk">0005 Authorization and Access Pattern</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/maps"><span title="0006 Azure Maps Integration Decision" class="linkLabel_P7mk">0006 Azure Maps Integration Decision</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/serenityjs"><span title="0007 SerenityJS" class="linkLabel_P7mk">0007 SerenityJS</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/cache-purging"><span title="0009 Cache Purging" class="linkLabel_P7mk">0009 Cache Purging</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/react-router-loaders"><span title="0010 React Router Loadeer" class="linkLabel_P7mk">0010 React Router Loadeer</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/bicep"><span title="0011 Bicep" class="linkLabel_P7mk">0011 Bicep</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/linter"><span title="0012 Linter Oxlint vs Biome" class="linkLabel_P7mk">0012 Linter Oxlint vs Biome</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/test-suite"><span title="0013 Test Suite Selection" class="linkLabel_P7mk">0013 Test Suite Selection</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/azure-infrastructure-deployments"><span title="0014 Azure Infrastructure Deployments" class="linkLabel_P7mk">0014 Azure Infrastructure Deployments</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/sonarcloud"><span title="0015 SonarCloud Node16 EOL" class="linkLabel_P7mk">0015 SonarCloud Node16 EOL</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/adr-template"><span title="ADR Template" class="linkLabel_P7mk">ADR Template</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/sonarcloud-code-duplication-checks"><span title="0016 SonarCloud Code Duplication Checks" class="linkLabel_P7mk">0016 SonarCloud Code Duplication Checks</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/adr-short-template"><span title="ADR Short Template" class="linkLabel_P7mk">ADR Short Template</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/chrome-content-overrides"><span title="0017 Chrome Content Overrides" class="linkLabel_P7mk">0017 Chrome Content Overrides</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/docusaurus-azure-pipeline-stages"><span title="0018 Docusaurus Azure Pipeline Stages" class="linkLabel_P7mk">0018 Docusaurus Azure Pipeline Stages</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/decisions/existing-azure-upload"><span title="0022 Existing Azure Upload" class="linkLabel_P7mk">0022 Existing Azure Upload</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/snyk-security-integration"><span title="snyk-security-integration" class="linkLabel_P7mk">snyk-security-integration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decisions/madr-agent-skills"><span title="0024 Agent Skills Integration" class="linkLabel_P7mk">0024 Agent Skills Integration</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_PIrx menu__link menu__link--sublist" href="/docs/category/security-overview"><span title="Security Overview" class="categoryLinkLabel_xVlR">Security Overview</span></a><button aria-label="Expand sidebar category &#x27;Security Overview&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_PIrx menu__link menu__link--sublist" href="/docs/category/security-requirements"><span title="Security Requirements" class="categoryLinkLabel_xVlR">Security Requirements</span></a><button aria-label="Expand sidebar category &#x27;Security Requirements&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_PIrx menu__link menu__link--sublist" href="/docs/category/threat-assessments"><span title="Threat Assessments" class="categoryLinkLabel_xVlR">Threat Assessments</span></a><button aria-label="Expand sidebar category &#x27;Threat Assessments&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_ZAAI"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_kgUi"><div class="docItemContainer_rSGg"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_EQ2J" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_CfSP"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/decisions"><span>Decisions</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">0022 Existing Azure Upload</span></li></ul></nav><div class="tocCollapsible_KgiJ theme-doc-toc-mobile tocMobile_I2QL"><button type="button" class="clean-btn tocCollapsibleButton_HE7g">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Existing Azure Upload Implementation</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Yx5z" id="context-and-problem-statement">Context and Problem Statement<a href="#context-and-problem-statement" class="hash-link" aria-label="Direct link to Context and Problem Statement" title="Direct link to Context and Problem Statement" translate="no">â€‹</a></h2>
<p>Our application requires a secure and scalable mechanism for handling file uploads. From the start, the design approach was to leverage Azure Blob Storage as the primary file storage service due to its reliability, scalability, and seamless integration with the Azure ecosystem.</p>
<p>Users need to upload various file types (PDFs, images) along with metadata and tags for tracking. The system implements a direct upload flow where the client requests authorization from the backend, which issues a short-lived SAS (Shared Access Signature) token allowing the file to be uploaded directly to Azure Blob Storage.</p>
<h2 class="anchor anchorTargetStickyNavbar_Yx5z" id="decision-drivers">Decision Drivers<a href="#decision-drivers" class="hash-link" aria-label="Direct link to Decision Drivers" title="Direct link to Decision Drivers" translate="no">â€‹</a></h2>
<ul>
<li class=""><strong>Scalability</strong>: The system must efficiently handle large file uploads and multiple concurrent requests without overloading backend services.</li>
<li class=""><strong>Performance</strong>: Direct client-to-Azure Blob uploads reduce backend latency and improve user upload speed.</li>
<li class=""><strong>Cost Optimization</strong>: Offloading upload bandwidth from backend servers to Azure Blob Storage minimizes infrastructure and data transfer costs.</li>
<li class=""><strong>Security</strong>: Uploads must be secure and authenticated. Short-lived SAS tokens (valet keys) provide controlled, time-bound access to the storage account.</li>
<li class=""><strong>Malware Scanning</strong>: Uploaded files must undergo malware scanning. Any malicious files must be identified, quarantined, and deleted immediately to maintain data integrity and user safety.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Yx5z" id="considered-options">Considered Options<a href="#considered-options" class="hash-link" aria-label="Direct link to Considered Options" title="Direct link to Considered Options" translate="no">â€‹</a></h2>
<ul>
<li class="">
<p><strong>Option 1: Backend-mediated uploads (server uploads to Blob Storage)</strong></p>
<ul>
<li class="">The client uploads files to the backend, which then transfers them to Azure Blob Storage.</li>
</ul>
</li>
<li class="">
<p><strong>Option 2: Direct client uploads using Azure Blob SAS tokens (current approach)</strong></p>
<ul>
<li class="">The backend generates a short-lived SAS token authorizing the client to upload directly to Blob Storage.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Yx5z" id="decision-outcome">Decision Outcome<a href="#decision-outcome" class="hash-link" aria-label="Direct link to Decision Outcome" title="Direct link to Decision Outcome" translate="no">â€‹</a></h2>
<p>Chosen option: <strong>Option 2: Direct client uploads using Azure Blob SAS tokens (current approach)</strong>, because it offloads upload traffic from the backend, reduces latency, lower cost, maintains security via short-lived tokens.</p>
<h2 class="anchor anchorTargetStickyNavbar_Yx5z" id="consequences">Consequences<a href="#consequences" class="hash-link" aria-label="Direct link to Consequences" title="Direct link to Consequences" translate="no">â€‹</a></h2>
<ul>
<li class="">Good, because uploading directly from the client to Azure Blob Storage significantly reduces backend bandwidth usage and infrastructure costs.</li>
<li class="">Good, because versioning support allows easy rollback in case of corruption or malicious file detection.</li>
<li class="">Bad, because malware scanning occurs after upload, introducing a brief exposure window before a file is fully validated.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Yx5z" id="implementation-details">Implementation Details<a href="#implementation-details" class="hash-link" aria-label="Direct link to Implementation Details" title="Direct link to Implementation Details" translate="no">â€‹</a></h2>
<p><strong>Frontend Components:</strong></p>
<ul>
<li class="">Handles client-side file validation (type, size, dimensions).</li>
<li class="">Requests authorization from the backend to upload a specific file.</li>
<li class="">Uses the received SAS token to upload the file directly to Azure Blob Storage.</li>
<li class="">After upload, notifies the backend to trigger malware scanning and persist upload metadata.</li>
</ul>
<p><strong>Backend Services:</strong></p>
<ul>
<li class="">
<p>SAS Token Generation:</p>
<ul>
<li class="">The backend handles SAS token generation and validation for Azure Blob Storage uploads, ensuring secure and controlled access for file uploads. There are different mutations for PDF and image files. The backend service encapsulates all business logic enforcing file upload restrictions and security requirements before enabling clients to upload files directly to Azure Blob Storage with short-lived and carefully permissioned SAS tokens.</li>
</ul>
</li>
<li class="">
<p>Post-Upload Malware Handling:</p>
<ul>
<li class="">The backend polls the blob for the Microsoft Defender for Cloud scan result tag: <code>No threats found</code> or <code>Malicious</code>.<!-- -->
<ul>
<li class=""><code>No threats found</code> â†’ retain the blob.</li>
<li class=""><code>Malicious</code> â†’ delete the current blob version and restore the previous non-malicious version.<!-- -->
<ul>
<li class="">The previous version is promoted to current using copyBlob.</li>
<li class="">Current malicious version is deleted, optionally using permanentlyDeleteBlobVersion if supported.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="">
<p>Versioning &amp; Recovery</p>
<ul>
<li class="">Blob versioning is enforced to support rollback.</li>
<li class="">Previous non-malicious versions are retained and promoted if a malicious file is detected.</li>
</ul>
</li>
</ul>
<p><strong>Sequence Diagram</strong></p>
<div class="language-mermaid codeBlockContainer_pcba theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_i37J"><pre tabindex="0" class="prism-code language-mermaid codeBlock_vlrX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_oa44"><span class="token-line" style="color:#393A34"><span class="token plain">sequenceDiagram</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">participant User</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">participant Frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">participant Backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">participant Blob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User-&gt;&gt;Frontend: Click upload and select file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Frontend-&gt;&gt;Frontend: Sanitize &amp; validate (type, size, dimensions)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Frontend-&gt;&gt;Backend: Request SAS token (name, type, size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Backend-&gt;&gt;Backend: Build blob path + tags + metadata, validate upload rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Backend--&gt;&gt;Frontend: AuthResult (blob URL + SAS token + x-ms-date + tags + metadata)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Frontend-&gt;&gt;Blob: PUT file bytes (headers + auth + tags + metadata)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Blob--&gt;&gt;Frontend: 201 Created (x-ms-version-id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Frontend-&gt;&gt;Backend: Persist blob reference/version ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Backend-&gt;&gt;Backend: Process blob( versionId and blobURL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alt Scan: No threats found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Backend-&gt;&gt;Frontend: Acknowledge success, retain blob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else Scan: Malicious</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Backend-&gt;&gt;Blob: Delete current malicious version, promote previous version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Backend-&gt;&gt;Frontend: Acknowledge file replacement or deletion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Frontend--&gt;&gt;User: Show success / preview / error if malicious</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Yx5z" id="technical-considerations-and-known-limitations">Technical Considerations and Known Limitations<a href="#technical-considerations-and-known-limitations" class="hash-link" aria-label="Direct link to Technical Considerations and Known Limitations" title="Direct link to Technical Considerations and Known Limitations" translate="no">â€‹</a></h2>
<ul>
<li class="">Malware scanning occurs after upload using Azure Blob Storageâ€™s capabilities. Files flagged as malicious are deleted or reverted to ensure data integrity. The system uses Microsoft Defender for Storage to automatically scan uploaded blobs for malware. Defender checks for known malware signatures, embedded scripts, and other suspicious file patterns. This introduces a small window where a malicious file may exist in storage before removal.</li>
<li class="">At present, backend permission enforcement for blob upload is minimal. The frontend restricts upload actions according to application state, but users could potentially bypass this if they possess valid credentials.</li>
<li class="">Future improvements will focus on implementing domain-driven permission checks before SAS tokens are issued and exploring pre-upload scanning alternatives to further reduce risk.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_bE00"><a href="https://github.com/simnova/sharethrift/tree/main/packages/docs/docs/decisions/0022-existing-azure-upload.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_K7ge" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_SpmY"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/decisions/docusaurus-azure-pipeline-stages"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">0018 Docusaurus Azure Pipeline Stages</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/decisions/snyk-security-integration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">snyk-security-integration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_ecJo thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#context-and-problem-statement" class="table-of-contents__link toc-highlight">Context and Problem Statement</a></li><li><a href="#decision-drivers" class="table-of-contents__link toc-highlight">Decision Drivers</a></li><li><a href="#considered-options" class="table-of-contents__link toc-highlight">Considered Options</a></li><li><a href="#decision-outcome" class="table-of-contents__link toc-highlight">Decision Outcome</a></li><li><a href="#consequences" class="table-of-contents__link toc-highlight">Consequences</a></li><li><a href="#implementation-details" class="table-of-contents__link toc-highlight">Implementation Details</a></li><li><a href="#technical-considerations-and-known-limitations" class="table-of-contents__link toc-highlight">Technical Considerations and Known Limitations</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Doc</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/sharethrift" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_z7OM"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/sharethrift" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_z7OM"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/sharethrift" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_z7OM"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/simnova/sharethrift" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_z7OM"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2026 Simnova, Inc.</div></div></div></footer></div>
</body>
</html>