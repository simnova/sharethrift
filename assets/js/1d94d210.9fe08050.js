"use strict";(globalThis.webpackChunk_sthrift_docs=globalThis.webpackChunk_sthrift_docs||[]).push([[2790],{5392(e,n,i){i.d(n,{R:()=>l,x:()=>a});var t=i(9081);const s={},r=t.createContext(s);function l(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(r.Provider,{value:n},e.children)}},8834(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"security-overview/pipeline-flow","title":"ShareThrift CI/CD Pipeline Flow","description":"ShareThrift CI/CD pipeline flow with security gates and deployment process","source":"@site/docs/security-overview/pipeline-flow.md","sourceDirName":"security-overview","slug":"/security-overview/pipeline-flow","permalink":"/docs/security-overview/pipeline-flow","draft":false,"unlisted":false,"editUrl":"https://github.com/simnova/sharethrift/tree/main/packages/docs/docs/security-overview/pipeline-flow.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"CI/CD Pipeline Flow","description":"ShareThrift CI/CD pipeline flow with security gates and deployment process","date":"2025-11-25T00:00:00.000Z"},"sidebar":"docsSidebar","previous":{"title":"Security Scanning Types","permalink":"/docs/security-overview/security-scanning-types"},"next":{"title":"Security Requirements","permalink":"/docs/category/security-requirements"}}');var s=i(8525),r=i(5392);const l={sidebar_position:2,sidebar_label:"CI/CD Pipeline Flow",description:"ShareThrift CI/CD pipeline flow with security gates and deployment process",date:new Date("2025-11-25T00:00:00.000Z")},a="ShareThrift CI/CD Pipeline Flow",c={},o=[{value:"Pipeline Overview",id:"pipeline-overview",level:2},{value:"Complete Pipeline Flow",id:"complete-pipeline-flow",level:2},{value:"Pipeline Stages Breakdown",id:"pipeline-stages-breakdown",level:2},{value:"<strong>Stage 1: Environment Setup</strong>",id:"stage-1-environment-setup",level:3},{value:"<strong>Stage 2: Dependency Management</strong>",id:"stage-2-dependency-management",level:3},{value:"<strong>Stage 3: Security Gates</strong>",id:"stage-3-security-gates",level:3},{value:"<strong>Security Gate 1: Dependency Vulnerability Scanning</strong>",id:"security-gate-1-dependency-vulnerability-scanning",level:4},{value:"<strong>Security Gate 2: Static Code Analysis</strong>",id:"security-gate-2-static-code-analysis",level:4},{value:"<strong>Stage 4: Build &amp; Test</strong>",id:"stage-4-build--test",level:3},{value:"<strong>Stage 5: Deployment (Main Branch Only)</strong>",id:"stage-5-deployment-main-branch-only",level:3},{value:"<strong>Deployment Conditions</strong>",id:"deployment-conditions",level:4},{value:"<strong>Infrastructure Deployment</strong>",id:"infrastructure-deployment",level:4},{value:"<strong>Application Deployment</strong>",id:"application-deployment",level:4},{value:"Key Pipeline Features",id:"key-pipeline-features",level:2},{value:"<strong>Change Detection</strong>",id:"change-detection",level:3},{value:"<strong>Caching Strategy</strong>",id:"caching-strategy",level:3},{value:"<strong>Security Integration Points</strong>",id:"security-integration-points",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"sharethrift-cicd-pipeline-flow",children:"ShareThrift CI/CD Pipeline Flow"})}),"\n",(0,s.jsx)(n.p,{children:"This document details the complete CI/CD pipeline flow for ShareThrift, highlighting security gates and deployment processes."}),"\n",(0,s.jsx)(n.h2,{id:"pipeline-overview",children:"Pipeline Overview"}),"\n",(0,s.jsxs)(n.p,{children:["Our pipeline implements a ",(0,s.jsx)(n.strong,{children:"security-first approach"})," with multiple gates that must pass before code reaches production. The pipeline automatically detects affected packages and only deploys when changes are detected."]}),"\n",(0,s.jsx)(n.h2,{id:"complete-pipeline-flow",children:"Complete Pipeline Flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:"graph TD\n    A[Developer Commits Code] --\x3e B{Target Branch?}\n    B --\x3e|Pull Request| C[PR Pipeline Triggered]\n    B --\x3e|Main Branch| D[Main Branch Pipeline Triggered]\n    \n    C --\x3e E[Environment Setup<br/>Ubuntu + Node.js 22.x + Tools]\n    D --\x3e E\n    \n    E --\x3e F[Cache Restoration<br/>PNPM/Turbo/Playwright/Java JRE]\n    F --\x3e G[Install Dependencies<br/>pnpm install --frozen-lockfile]\n    G --\x3e H[Change Detection<br/>detect-changes.cjs script]\n    \n    H --\x3e I[Security Gate 1:<br/>PNPM Audit]\n    I --\x3e J{High Vulnerabilities?}\n    J --\x3e|Found| K[\u274c FAIL: Block Build<br/>Security Issues Detected]\n    J --\x3e|None| L[Build & Test Affected Packages<br/>Turbo --affected]\n    \n    L --\x3e M[Coverage Report Generation<br/>LCOV format]\n    M --\x3e N[Security Gate 2:<br/>SonarCloud Analysis]\n    N --\x3e O{Quality Gate Pass?}\n    O --\x3e|Fail| P[\u274c FAIL: Quality Gate<br/>Code Quality/Security Issues]\n    O --\x3e|Pass| Q[Create Deployment Artifacts<br/>ZIP packages for API/UI/Docs]\n    \n    Q --\x3e R{Build Reason Check}\n    R --\x3e|Pull Request| S[\u2705 SUCCESS<br/>PR Validation Complete]\n    R --\x3e|Main Branch| T[DEV Deployment Stage]\n    \n    T --\x3e U[Deploy Infrastructure<br/>Bicep Templates \u2192 Azure]\n    U --\x3e V[Deploy API Application<br/>Azure Functions]\n    V --\x3e W[Configure Application Settings<br/>Key Vault Integration]\n    W --\x3e X[Deploy UI Application<br/>Static Website]\n    X --\x3e Y[Deploy Documentation<br/>Docusaurus Site]\n    Y --\x3e Z[\u2705 SUCCESS<br/>DEV Environment Ready]\n\n"})}),"\n",(0,s.jsx)(n.h2,{id:"pipeline-stages-breakdown",children:"Pipeline Stages Breakdown"}),"\n",(0,s.jsx)(n.h3,{id:"stage-1-environment-setup",children:(0,s.jsx)(n.strong,{children:"Stage 1: Environment Setup"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Agent"}),": Ubuntu Latest"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Runtime"}),": Node.js 22.x"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tools"}),": Azure Functions Core Tools 4.2.1, PNPM Latest-10"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Caching"}),": Multiple cache layers for performance optimization"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"stage-2-dependency-management",children:(0,s.jsx)(n.strong,{children:"Stage 2: Dependency Management"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Install dependencies with frozen lockfile\npnpm install --frozen-lockfile\n\n# Detect which packages are affected by changes\nnode ./build-pipeline/scripts/detect-changes.cjs\n"})}),"\n",(0,s.jsx)(n.h3,{id:"stage-3-security-gates",children:(0,s.jsx)(n.strong,{children:"Stage 3: Security Gates"})}),"\n",(0,s.jsx)(n.h4,{id:"security-gate-1-dependency-vulnerability-scanning",children:(0,s.jsx)(n.strong,{children:"Security Gate 1: Dependency Vulnerability Scanning"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# PNPM Audit - High severity threshold\npnpm audit --audit-level=high --prod\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Purpose"}),": Detect known vulnerabilities in production dependencies"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Threshold"}),": High severity issues block the build"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Scope"}),": Production dependencies only"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"security-gate-2-static-code-analysis",children:(0,s.jsx)(n.strong,{children:"Security Gate 2: Static Code Analysis"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# SonarCloud Analysis\npnpm run sonar -Dsonar.pullrequest.key="$PR_NUMBER" \\\n               -Dsonar.pullrequest.branch="$PR_BRANCH" \\\n               -Dsonar.pullrequest.base=main\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tool"}),": SonarCloud"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Organization"}),": ",(0,s.jsx)(n.code,{children:"simnova"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Project"}),": ",(0,s.jsx)(n.code,{children:"simnova_sharethrift-data-access"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Quality Gate"}),": Enforced (breaks build on failure)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"stage-4-build--test",children:(0,s.jsx)(n.strong,{children:"Stage 4: Build & Test"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Build and test only affected packages\npnpm run test:coverage --affected\n\n# Merge coverage reports for SonarCloud\npnpm run merge-lcov-reports\n"})}),"\n",(0,s.jsx)(n.h3,{id:"stage-5-deployment-main-branch-only",children:(0,s.jsx)(n.strong,{children:"Stage 5: Deployment (Main Branch Only)"})}),"\n",(0,s.jsx)(n.h4,{id:"deployment-conditions",children:(0,s.jsx)(n.strong,{children:"Deployment Conditions"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 All security gates passed"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Build reason is NOT Pull Request"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Changes detected in affected packages"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"infrastructure-deployment",children:(0,s.jsx)(n.strong,{children:"Infrastructure Deployment"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"- task: AzureResourceManagerTemplateDeployment@3\n  inputs:\n    csmFile: apps/api/iac/main.bicep\n    csmParametersFile: apps/api/iac/dev.bicepparam\n"})}),"\n",(0,s.jsx)(n.h4,{id:"application-deployment",children:(0,s.jsx)(n.strong,{children:"Application Deployment"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"- task: AzureFunctionApp@1\n  inputs:\n    appName: $(functionAppNamePri)\n    package: '$(Pipeline.Workspace)/api/api-$(Build.BuildId).zip'\n    runtimeStack: 'NODE|22'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"key-pipeline-features",children:"Key Pipeline Features"}),"\n",(0,s.jsx)(n.h3,{id:"change-detection",children:(0,s.jsx)(n.strong,{children:"Change Detection"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Uses Turbo's ",(0,s.jsx)(n.code,{children:"--affected"})," flag for intelligent change detection"]}),"\n",(0,s.jsx)(n.li,{children:"Only builds and deploys packages that have changes"}),"\n",(0,s.jsx)(n.li,{children:"Compares against target branch (main) for PR builds"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"caching-strategy",children:(0,s.jsx)(n.strong,{children:"Caching Strategy"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PNPM Store"}),": Package dependency caching"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Turbo Cache"}),": Build artifact caching"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Playwright Browsers"}),": Browser binary caching"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Java JRE"}),": SonarCloud scanner dependency caching"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SonarCloud Scanner"}),": Analysis engine caching"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"security-integration-points",children:(0,s.jsx)(n.strong,{children:"Security Integration Points"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Stage"}),(0,s.jsx)(n.th,{children:"Security Tool"}),(0,s.jsx)(n.th,{children:"Purpose"}),(0,s.jsx)(n.th,{children:"Failure Action"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Dependencies"}),(0,s.jsx)(n.td,{children:"PNPM Audit"}),(0,s.jsx)(n.td,{children:"Vulnerability scanning"}),(0,s.jsx)(n.td,{children:"Block build"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Code Analysis"}),(0,s.jsx)(n.td,{children:"SonarCloud"}),(0,s.jsx)(n.td,{children:"Code quality & security"}),(0,s.jsx)(n.td,{children:"Block build"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Infrastructure"}),(0,s.jsx)(n.td,{children:"Bicep Templates"}),(0,s.jsx)(n.td,{children:"Secure infrastructure"}),(0,s.jsx)(n.td,{children:"Deployment validation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Runtime"}),(0,s.jsx)(n.td,{children:"Azure Key Vault"}),(0,s.jsx)(n.td,{children:"Secret management"}),(0,s.jsx)(n.td,{children:"Secure configuration"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);