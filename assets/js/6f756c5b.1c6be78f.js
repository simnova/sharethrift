"use strict";(globalThis.webpackChunk_sthrift_docs=globalThis.webpackChunk_sthrift_docs||[]).push([[4047],{5392(e,s,n){n.d(s,{R:()=>r,x:()=>l});var i=n(9081);const t={},o=i.createContext(t);function r(e){const s=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(o.Provider,{value:s},e.children)}},7647(e,s,n){n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"technical-overview/localhost-subdomain-setup","title":"Localhost Subdomain Development Setup","description":"Guide to setting up HTTPS-enabled localhost subdomains for local development","source":"@site/docs/technical-overview/localhost-subdomain-setup.md","sourceDirName":"technical-overview","slug":"/technical-overview/localhost-subdomain-setup","permalink":"/docs/technical-overview/localhost-subdomain-setup","draft":false,"unlisted":false,"editUrl":"https://github.com/simnova/sharethrift/tree/main/packages/docs/docs/technical-overview/localhost-subdomain-setup.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"sidebar_label":"Localhost Subdomain Setup","description":"Guide to setting up HTTPS-enabled localhost subdomains for local development"},"sidebar":"docsSidebar","previous":{"title":"Contexts","permalink":"/docs/technical-overview/contexts"},"next":{"title":"Decisions","permalink":"/docs/category/decisions"}}');var t=n(8525),o=n(5392);const r={sidebar_position:3,sidebar_label:"Localhost Subdomain Setup",description:"Guide to setting up HTTPS-enabled localhost subdomains for local development"},l="Localhost Subdomain Development Setup",c={},a=[{value:"Local Development Subdomains",id:"local-development-subdomains",level:2},{value:"Application Services",id:"application-services",level:3},{value:"Mock Services",id:"mock-services",level:3},{value:"HTTPS Proxy Architecture",id:"https-proxy-architecture",level:2},{value:"Quick Setup",id:"quick-setup",level:2},{value:"Install mkcert",id:"install-mkcert",level:3},{value:"Generate Certificates",id:"generate-certificates",level:3},{value:"Cookie and CORS Configuration",id:"cookie-and-cors-configuration",level:2},{value:"Cross-Subdomain Cookies",id:"cross-subdomain-cookies",level:3},{value:"CORS Setup",id:"cors-setup",level:3},{value:"CI/CD Compatibility",id:"cicd-compatibility",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Certificate Not Trusted",id:"certificate-not-trusted",level:3},{value:"Port Already in Use",id:"port-already-in-use",level:3},{value:"CORS Errors",id:"cors-errors",level:3},{value:"Additional Resources",id:"additional-resources",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"localhost-subdomain-development-setup",children:"Localhost Subdomain Development Setup"})}),"\n",(0,t.jsxs)(s.p,{children:["Sharethrift uses a subdomain-based architecture in local development with ",(0,t.jsx)(s.code,{children:"*.sharethrift.localhost"})," domains and HTTPS to mirror production and support OAuth, cookie sharing, and CORS testing."]}),"\n",(0,t.jsx)(s.h2,{id:"local-development-subdomains",children:"Local Development Subdomains"}),"\n",(0,t.jsx)(s.h3,{id:"application-services",children:"Application Services"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Frontend UI"}),": ",(0,t.jsx)(s.code,{children:"https://sharethrift.localhost:3000"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Backend API (HTTPS proxy)"}),": ",(0,t.jsx)(s.code,{children:"https://data-access.sharethrift.localhost:7072"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Backend API (HTTP direct)"}),": ",(0,t.jsx)(s.code,{children:"http://localhost:7071"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Documentation"}),": ",(0,t.jsx)(s.code,{children:"https://docs.sharethrift.localhost:3002"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"mock-services",children:"Mock Services"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Payment"}),": ",(0,t.jsx)(s.code,{children:"https://mock-payment.sharethrift.localhost:3001"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Messaging"}),": ",(0,t.jsx)(s.code,{children:"https://mock-messaging.sharethrift.localhost:10000"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Auth"}),": ",(0,t.jsx)(s.code,{children:"https://mock-auth.sharethrift.localhost:4000"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"MongoDB"}),": ",(0,t.jsx)(s.code,{children:"mongodb://mongodb.sharethrift.localhost:50000"})]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"https-proxy-architecture",children:"HTTPS Proxy Architecture"}),"\n",(0,t.jsxs)(s.p,{children:["Azure Functions Core Tools v4.2.2 has a broken ",(0,t.jsx)(s.code,{children:"--cert"})," flag that ignores custom certificates. Instead, we use a custom Node.js HTTPS proxy:"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Azure Functions runs HTTP-only on port 7071"}),"\n",(0,t.jsx)(s.li,{children:"HTTPS proxy on port 7072 with mkcert wildcard certificate"}),"\n",(0,t.jsxs)(s.li,{children:["Routes ",(0,t.jsx)(s.code,{children:"https://data-access.sharethrift.localhost:7072"})," \u2192 ",(0,t.jsx)(s.code,{children:"http://localhost:7071"})]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["See ",(0,t.jsx)(s.code,{children:"local-https-proxy.js"})," in the repository root."]}),"\n",(0,t.jsx)(s.h2,{id:"quick-setup",children:"Quick Setup"}),"\n",(0,t.jsx)(s.h3,{id:"install-mkcert",children:"Install mkcert"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"macOS"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"brew install mkcert nss\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Windows"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"choco install mkcert\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Linux"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'sudo apt install libnss3-tools\ncurl -JLO "https://dl.filippo.io/mkcert/latest?for=linux/amd64"\nchmod +x mkcert-v*-linux-amd64\nsudo mv mkcert-v*-linux-amd64 /usr/local/bin/mkcert\n'})}),"\n",(0,t.jsx)(s.h3,{id:"generate-certificates",children:"Generate Certificates"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'mkcert -install\nmkdir -p .certs && cd .certs\nmkcert "*.sharethrift.localhost" "sharethrift.localhost" localhost 127.0.0.1 ::1\n'})}),"\n",(0,t.jsxs)(s.p,{children:["Certificates are stored in ",(0,t.jsx)(s.code,{children:"/.certs"})," (gitignored)."]}),"\n",(0,t.jsx)(s.h2,{id:"cookie-and-cors-configuration",children:"Cookie and CORS Configuration"}),"\n",(0,t.jsx)(s.h3,{id:"cross-subdomain-cookies",children:"Cross-Subdomain Cookies"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-typescript",children:"res.cookie('session', token, {\n  domain: '.sharethrift.localhost',  // Leading dot for subdomain sharing\n  secure: true,                       // HTTPS only\n  httpOnly: true,\n  sameSite: 'lax',\n});\n"})}),"\n",(0,t.jsx)(s.h3,{id:"cors-setup",children:"CORS Setup"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-typescript",children:"const corsOptions = {\n  origin: [\n    'https://sharethrift.localhost',\n    'https://data-access.sharethrift.localhost',\n    'https://docs.sharethrift.localhost',\n  ],\n  credentials: true,\n};\n"})}),"\n",(0,t.jsx)(s.h2,{id:"cicd-compatibility",children:"CI/CD Compatibility"}),"\n",(0,t.jsxs)(s.p,{children:["The subdomain setup is ",(0,t.jsx)(s.strong,{children:"local development only"}),". All services gracefully fall back to HTTP when certificates don't exist:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Certificate files are gitignored"}),"\n",(0,t.jsxs)(s.li,{children:["Services detect missing certs with ",(0,t.jsx)(s.code,{children:"fs.existsSync()"})]}),"\n",(0,t.jsx)(s.li,{children:"CI/CD pipelines skip cert generation"}),"\n",(0,t.jsx)(s.li,{children:"No environment variables needed"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Local"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"pnpm run dev  # \u2192 HTTPS with certs\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"CI/CD"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"pnpm test  # \u2192 HTTP fallback (no certs)\n"})}),"\n",(0,t.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(s.h3,{id:"certificate-not-trusted",children:"Certificate Not Trusted"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"mkcert -install  # Reinstall CA\n# Restart browser\n"})}),"\n",(0,t.jsx)(s.h3,{id:"port-already-in-use",children:"Port Already in Use"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo lsof -i :7072\nsudo kill -9 <PID>\n"})}),"\n",(0,t.jsx)(s.h3,{id:"cors-errors",children:"CORS Errors"}),"\n",(0,t.jsxs)(s.p,{children:["Add subdomain to CORS ",(0,t.jsx)(s.code,{children:"origin"})," array and ensure ",(0,t.jsx)(s.code,{children:"credentials: true"}),"."]}),"\n",(0,t.jsx)(s.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://github.com/FiloSottile/mkcert",children:"mkcert"})," - Local certificate authority"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local",children:"Azure Functions Core Tools"})," - Local runtime"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);